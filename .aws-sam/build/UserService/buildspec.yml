version: 0.2

env:
  variables:
    PACT_BUCKET_NAME: "your-pact-bucket-name"
    SERVICE_NAME: "energy-service"

phases:
  install:
    runtime-versions:
      python: 3.9
    commands:
      - pip install -r requirements.txt
      - pip install pytest pact-python boto3

  pre_build:
    commands:
      - echo "Running unit tests"
      - pytest tests/unit/ 

  build:
    commands:
      - echo "Running Pact consumer tests"
      - pytest tests/pact_tests.py
      - echo "Preparing deployment package"
      - zip -r deployment-package.zip .
      - echo "Updating Lambda function"
      - aws lambda update-function-code --function-name $ENERGY_LAMBDA_AR